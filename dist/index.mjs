function F(e,t={}){return e.type==="decl"&&(t[e.prop]=e.value),t}function C(e,t={},i=!0){if(e.type==="rule"){let s={};for(let n of e.nodes)n.type==="decl"?s=F(n,s):n.type==="rule"?s=C(n,s):n.type==="atrule"&&(s=I(n,s));if(i)t[e.selector]=s;else return s;return t}}function I(e,t={}){var i;if(e.type==="atrule"){let s={};if((i=e.nodes)!=null&&i[Symbol.iterator])for(let n of e.nodes)n.type==="decl"?s=F(n,s):n.type==="rule"?s=C(n,s):n.type==="atrule"&&(s=I(n,s));return t[`@${e.name} ${e.params}`]=s,t}}var W=new Set(["normal","reverse","alternate","alternate-reverse"]),Q=new Set(["running","paused"]),q=new Set(["none","forwards","backwards","both"]),H=new Set(["infinite"]),X=new Set(["linear","ease","ease-in","ease-out","ease-in-out","step-start","step-end"]),Z=["cubic-bezier","steps"],ee=/,(?![^(]*\))/g,te=/ +(?![^(]*\))/g,O=/^(-?[\d.]+m?s)$/,re=/^(\d+)$/;function b(e){return e.split(ee).map(i=>{var a;let s=i.trim(),n={value:s},l=s.split(te),o=new Set;for(let r of l)!o.has("DIRECTIONS")&&W.has(r)?(n.direction=r,o.add("DIRECTIONS")):!o.has("PLAY_STATES")&&Q.has(r)?(n.playState=r,o.add("PLAY_STATES")):!o.has("FILL_MODES")&&q.has(r)?(n.fillMode=r,o.add("FILL_MODES")):!o.has("ITERATION_COUNTS")&&(H.has(r)||re.test(r))?(n.iterationCount=r,o.add("ITERATION_COUNTS")):!o.has("TIMING_FUNCTION")&&X.has(r)||!o.has("TIMING_FUNCTION")&&Z.some(u=>r.startsWith(`${u}(`))?(n.timingFunction=r,o.add("TIMING_FUNCTION")):!o.has("DURATION")&&O.test(r)?(n.duration=r,o.add("DURATION")):!o.has("DELAY")&&O.test(r)?(n.delay=r,o.add("DELAY")):o.has("NAME")?((a=n.unknown)!=null||(n.unknown=[]),n.unknown.push(r)):(n.name=r,o.add("NAME"));return n})}var v=new Map,h=new Map;function $(){v.clear(),h.clear()}function D(e,t,i){if(e.name==="keyframes"){if(e.parent.type=="rule")return!1;let s=m(e);return v.set(s,e),!0}return!1}function U(e,t,i,s,n){var l;for(let[o,a]of h.entries()){let r=a.rule;t.delete(o),i.delete(o);let u=C(r,{},!1),M=n.animationPrefix,p=new w({node:r,stringifiedNode:u},M);for(let y of a.keyframes){let g=v.get(y);if(g==null){let k=(l=s.get(y))!=null?l:new Set;k.has(r.selector)||k.add(r.selector);continue}let Y=I(g);p.content.push({node:g,stringifiedNode:Y})}e.set(o,p)}}function K(e,t){var i,s;if(e.prop=="animation"){let n=m(t),l=b(e.value),o=!1;for(let a of l){let r=a.name;if(r==null)continue;let u=(i=h.get(n))!=null?i:{rule:t,keyframes:new Set};u.keyframes.has(r)||u.keyframes.add(`@keyframes ${r}`),h.set(n,u),o=!0}return o}else if(e.prop=="animation-name"){let n=m(t),l=(s=h.get(n))!=null?s:{rule:t,keyframes:new Set};return l.keyframes.has(e.value)||l.keyframes.add(`@keyframes ${e.value}`),h.set(n,l),!0}return!1}function m(e){let t="";return e.type=="rule"?(e=e,t=e.selector):e.type=="atrule"&&(e=e,t=`@${e.name} ${e.params}`),t}function R(e,t,i,s,n=1){if(e.nodes==null||e.nodes.length==0)return;let l="",o="";for(let r=0;r<n;r++)l+="	",r<n-1&&(o+="	");let a=t.openBracketNewLine?`
${o}`:" ";if(e.type==="rule"){let r=e,u=r.selectors.join(`,
${o}`);r.selector=u,r.raws.between=a}else if(e.type=="atrule"){let r=e;r.params=r.params.trim(),r.raws.afterName=" ",r.raws.between=a}for(let r of e.nodes)r.type=="decl"&&s.type=="rule"&&K(r,s),r.raws.before=`
`+l,r.raws.after=`
`+l,R(r,t,i,s,n+1);n==1&&(e.raws.before=`
`,t.commentType!=="None"&&(e.raws.before+=`/* From ${i.opts.from} */
`),e.raws.after=`
`)}var w=class{constructor(t,i){this.content=[];this.rule=t,this.intellisensePrefix=i}getMatchedContent(){let t={},i=this.content.map(n=>n.stringifiedNode),s=Object.fromEntries(i.entries());return t[this.intellisensePrefix]=()=>[s,this.rule.stringifiedNode],t}getMatchedValues(){let t={},i=m(this.rule.node).match(/\w+/g).join("-");return t[i]="",{values:t}}};import{readFileSync as _}from"fs";import{resolve as j}from"path";import ne from"postcss";var x="[layer-parser]:";function A(e=1){let t=`
`;for(let i=0;i<e;i++)t+="	";return t+="- ",t}function P(e){console.log(`${x} ${e}`)}function f(e){console.warn(`${x} ${e}`)}function J(e){console.error(`${x} ${e}`)}import{globSync as se}from"glob";var d=new Map,c=new Map,L=new Map,N=new Map,S=new Map,T=new Map;function z(e,t){let i=m(e);if(c.has(i)||d.has(i)){let s=N.get(i);if(s){let n=s==null?void 0:s.get(t.opts.from);n?s.set(t.opts.from,n+1):s.set(t.opts.from,1)}else N.set(i,new Map([[t.opts.from,1]]));return!1}return!0}function ie(e,t,i){var n,l,o;let s=m(e);if(((n=e.parent)==null?void 0:n.type)==="root"){if(z(e,t)){if(i.unlayeredClassBehavior==="Ignore"){let a=(l=S.get(s))!=null?l:new Set;a.add(t.opts.from),S.set(s,a);return}R(e,i,t,e),i.unlayeredClassBehavior==="Utility"?c.set(s,e):i.unlayeredClassBehavior==="Component"&&d.set(s,e)}}else if(((o=e.parent)==null?void 0:o.type)=="atrule"&&z(e,t)){let a=e.parent;a.params==="components"?(R(e,i,t,e),d.set(s,e)):a.params==="utilities"&&(R(e,i,t,e),c.set(s,e))}}function ae(e,t,i){D(e,t,i)}function oe(e){return()=>({Rule(t,{result:i}){ie(t,i,e)},AtRule:{keyframes:(t,{result:i})=>{ae(t,i,e)}}})}function le(e){var i,s,n,l,o;let t=a=>a!==!0&&a!==!1;e.directory==null&&(f("There was no directory provided. Defaulting to process.cwd()."),e.directory=process.cwd()),(i=e.commentType)!=null||(e.commentType="File"),e.commentType!=="File"&&e.commentType!="Absolute"&&e.commentType!="None"&&(f("Invalid configuration for commentType. Defaulting to 'File'"),e.commentType="File"),(s=e.openBracketNewLine)!=null||(e.openBracketNewLine=!1),t(e.openBracketNewLine)&&(f("Invalid configuration for openBracketNewLine. Defaulting to false"),e.openBracketNewLine=!1),(n=e.debug)!=null||(e.debug=!1),t(e.debug)&&(f("Invalid configuration for debug. Defaulting to false."),e.debug=!1),(l=e.unlayeredClassBehavior)!=null||(e.unlayeredClassBehavior="Utility"),e.unlayeredClassBehavior!=="Utility"&&e.unlayeredClassBehavior!=="Component"&&e.unlayeredClassBehavior!=="Ignore"&&(f("Invalid configuration for unlayedClassBehavior. Defaulting to Utility"),e.unlayeredClassBehavior="Utility"),(o=e.globPatterns)!=null||(e.globPatterns=["**/*.css"]),(e.animationPrefix==null||e.animationPrefix.trim().length==0)&&(e.animationPrefix="animate")}function G(){d.size==0&&c.size==0&&P("Reset parsed components and utilities."),d.clear(),c.clear(),L.clear(),$()}function V(e){if(e.globPatterns!=null&&e.globPatterns.length>0){for(let a of e.globPatterns)if(a.startsWith("/**"))return J(`
					User attempted to glob their entire computer using: ${a}.
					This would result in a serious performance problem, and thus parsing has been skipped.
				`),{components:[],utilities:[],keyframeUtilities:[]}}le(e),N.clear(),S.clear(),T.clear();let t=j(e.directory),i=[];i=se(e.globPatterns,{cwd:t}),e.debug&&(P(`Searched directories: ${t}`),P(`Found: ${i.join("	")}`));let s={postcssPlugin:"layer-parser",prepare:oe(e)},n=[],l=ne([s]),o;switch(e.commentType){case"Absolute":o=(a,r)=>{let u=_(r,"utf8");l.process(u,{from:r,to:r}).then()};break;default:o=(a,r)=>{let u=_(r,"utf8");l.process(u,{from:a,to:a}).then()};break}for(let a of i){if(!a.endsWith(".css")){n.push(a);continue}let r=j(t,a);o(a,r)}if(n.length>0&&f(`Globbing resulted in files that did not end in .css:
	${n.join(A())}`),S.size>0){let a=`The target directory: ${e.directory} had ${S.size} unlayered css rules not parsed:`;if(e.debug)for(let[r,u]of S)a+=`
	${r}`,a+=`
		- `,a+=Array.from(u.values()).join(A(2));f(a)}if(N.size>0){let a="",r=0;for(let[M,p]of N){a+=`
	${M}`;for(let[y,g]of p)a+=`${A(2)}${y} - ${g}`,r+=g}let u=`Found ${r} rules with selectors that were already used.
			Note, this only discovers root-level (not nested) duplicates that would be added based on the configuration.`;e.debug&&(u+=a),f(u)}if(U(L,d,c,T,e),T.size>0){let a="",r=0;for(let[M,p]of T){a+=`
	${M}`,r+=p.size;for(let y of p)a+=`${A(2)}${y}`}let u=`Could not find ${r} keyframes that were referenced by the searched CSS files.`;e.debug&&(u+=a),f(u)}return{utilities:Array.from(c.values()),components:Array.from(d.values()),keyframeUtilities:Array.from(L.values())}}function Le(e){return({addUtilities:t,addComponents:i,matchUtilities:s})=>{G();let n=V(e);console.log("Utilities:",n.utilities.length,"Components:",n.components.length);for(let l of n.utilities)console.log(l.toString(),`
`),t(l.toString());for(let l of n.components)i({".test-class":{transition:`background-color,
color,
display`}});for(let l of n.keyframeUtilities)s(l.getMatchedContent(),l.getMatchedValues())}}export{w as MatchedAnimationRule,Le as ParseCSS,V as cssParser,G as resetData};
