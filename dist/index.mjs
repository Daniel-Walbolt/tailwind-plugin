function f(e){let t="";return e.type=="rule"&&(e=e,t=e.selector),t}var x=class{constructor(t,r){this.content=[];this.rule=t,this.intellisensePrefix=r}getMatchedContent(){let t={},r=this.content.map(n=>n.stringifiedNode),i=Object.fromEntries(r.entries());return t[this.intellisensePrefix]=()=>[i,this.rule.stringifiedNode],t}getMatchedValues(){let t={},r=f(this.rule.node).match(/\w+/g).join("-");return t[r]="",{values:t}}};import{readFileSync as L}from"fs";import{resolve as N}from"path";import F from"postcss";var h="[layer-parser]:";function c(e=1){let t=`
`;for(let r=0;r<e;r++)t+="	";return t+="- ",t}function g(e){console.log(`${h} ${e}`)}function u(e){console.warn(`${h} ${e}`)}function P(e){console.error(`${h} ${e}`)}import{globSync as D}from"glob";function M(e,t={}){return e.type==="decl"&&(t[e.prop]=e.value),t}function m(e,t={},r=!0){if(e.type==="rule"){let i={};for(let n of e.nodes)n.type==="decl"?i=M(n,i):n.type==="rule"?i=m(n,i,r):n.type==="atrule"&&(i=b(n,i,r));if(r)t[e.selector]=i;else return i;return t}}function b(e,t={},r=!0){var i;if(e.type==="atrule"){let n={};if((i=e.nodes)!=null&&i[Symbol.iterator])for(let o of e.nodes)o.type==="decl"?n=M(o,n):o.type==="rule"?n=m(o,n,r):o.type==="atrule"&&(n=b(o,n,r));return t[`@${e.name} ${e.params}`]=n,t}}var d=new Map,p=new Map,y=new Map;function I(e,t){let r=f(e);if(d.has(r)){let i=p.get(r);if(i){let n=i==null?void 0:i.get(t.opts.from);n?i.set(t.opts.from,n+1):i.set(t.opts.from,1)}else p.set(r,new Map([[t.opts.from,1]]));return!1}return!0}function j(e,t){var i,n;if(((i=e.parent)==null?void 0:i.type)==="atrule"){let o=e.parent;if(o.params!=="components"&&o.params!=="utilities")return}else if(((n=e.parent)==null?void 0:n.type)!=="root")return;let r=f(e);if(I(e,t)){let o=m(e,{},!0);d.set(r,o)}}function T(){return()=>({Rule(e,{result:t}){j(e,t)}})}function U(e){var r,i;let t=n=>n!==!0&&n!==!1;e.directory==null&&(u("There was no directory provided. Defaulting to process.cwd()."),e.directory=process.cwd()),(r=e.debug)!=null||(e.debug=!1),t(e.debug)&&(u("Invalid configuration for debug. Defaulting to false."),e.debug=!1),(i=e.globPatterns)!=null||(e.globPatterns=["**/*.css"]),(e.animationPrefix==null||e.animationPrefix.trim().length==0)&&(e.animationPrefix="animate")}function v(){d.size==0&&g("Reset parsed components and utilities."),d.clear()}function C(e){if(e.globPatterns!=null&&e.globPatterns.length>0){for(let s of e.globPatterns)if(s.startsWith("/**"))return P(`
					User attempted to glob their entire computer using: ${s}.
					This would result in a serious performance problem, and thus parsing has been skipped.
				`),{utilities:[]}}U(e),p.clear(),y.clear();let t=N(e.directory),r=[];r=D(e.globPatterns,{cwd:t}),e.debug&&(g(`Searched directories: ${t}`),g(`Found: ${r.join("	")}`));let i={postcssPlugin:"layer-parser",prepare:T()},n=[],o=F([i]),J=(s,a)=>{let l=L(a,"utf8");o.process(l,{from:s,to:s}).then()};for(let s of r){if(!s.endsWith(".css")){n.push(s);continue}let a=N(t,s);J(s,a)}if(n.length>0&&u(`Globbing resulted in files that did not end in .css:
	${n.join(c())}`),y.size>0){let s=`The target directory: ${e.directory} had ${y.size} unlayered css rules not parsed:`;if(e.debug)for(let[a,l]of y)s+=`
	${a}`,s+=`
		- `,s+=Array.from(l.values()).join(c(2));u(s)}if(p.size>0){let s="",a=0;for(let[O,$]of p){s+=`
	${O}`;for(let[w,S]of $)s+=`${c(2)}${w} - ${S}`,a+=S}let l=`Found ${a} rules with selectors that were already used.
			Note, this only discovers root-level (not nested) duplicates that would be added based on the configuration.`;e.debug&&(l+=s),u(l)}return{utilities:Array.from(d.values())}}function Z(e){return({addUtilities:t})=>{v();let r=C(e);for(let i of r.utilities)t(i)}}export{x as MatchedAnimationRule,Z as ParseCSS,C as cssParser,v as resetData};
