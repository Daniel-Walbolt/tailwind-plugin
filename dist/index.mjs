function F(e,t={}){return e.type==="decl"&&(t[e.prop]=e.value),t}function C(e,t={},s=!0){if(e.type==="rule"){let i={};for(let n of e.nodes)n.type==="decl"?i=F(n,i):n.type==="rule"?i=C(n,i):n.type==="atrule"&&(i=I(n,i));if(s)t[e.selector]=i;else return i;return t}}function I(e,t={}){var s;if(e.type==="atrule"){let i={};if((s=e.nodes)!=null&&s[Symbol.iterator])for(let n of e.nodes)n.type==="decl"?i=F(n,i):n.type==="rule"?i=C(n,i):n.type==="atrule"&&(i=I(n,i));return t[`@${e.name} ${e.params}`]=i,t}}var W=new Set(["normal","reverse","alternate","alternate-reverse"]),Q=new Set(["running","paused"]),q=new Set(["none","forwards","backwards","both"]),H=new Set(["infinite"]),X=new Set(["linear","ease","ease-in","ease-out","ease-in-out","step-start","step-end"]),Z=["cubic-bezier","steps"],ee=/\,(?![^(]*\))/g,te=/\ +(?![^(]*\))/g,O=/^(-?[\d.]+m?s)$/,re=/^(\d+)$/;function b(e){return e.split(ee).map(s=>{var a;let i=s.trim(),n={value:i},l=i.split(te),o=new Set;for(let r of l)!o.has("DIRECTIONS")&&W.has(r)?(n.direction=r,o.add("DIRECTIONS")):!o.has("PLAY_STATES")&&Q.has(r)?(n.playState=r,o.add("PLAY_STATES")):!o.has("FILL_MODES")&&q.has(r)?(n.fillMode=r,o.add("FILL_MODES")):!o.has("ITERATION_COUNTS")&&(H.has(r)||re.test(r))?(n.iterationCount=r,o.add("ITERATION_COUNTS")):!o.has("TIMING_FUNCTION")&&X.has(r)||!o.has("TIMING_FUNCTION")&&Z.some(f=>r.startsWith(`${f}(`))?(n.timingFunction=r,o.add("TIMING_FUNCTION")):!o.has("DURATION")&&O.test(r)?(n.duration=r,o.add("DURATION")):!o.has("DELAY")&&O.test(r)?(n.delay=r,o.add("DELAY")):o.has("NAME")?((a=n.unknown)!=null||(n.unknown=[]),n.unknown.push(r)):(n.name=r,o.add("NAME"));return n})}var v=new Map,S=new Map;function $(){v.clear(),S.clear()}function D(e,t,s){if(e.name="keyframes"){if(e.parent.type=="rule")return!1;let i=m(e);return v.set(i,e),!0}return!1}function K(e,t,s,i,n){var l;for(let[o,a]of S.entries()){let r=a.rule;t.delete(o),s.delete(o);let f=C(r,{},!1),d=n.animationPrefix,p=new w({node:r,stringifiedNode:f},d);for(let g of a.keyframes){let h=v.get(g);if(h==null){let k=(l=i.get(g))!=null?l:new Set;k.has(r.selector)||k.add(r.selector);continue}let Y=I(h);p.content.push({node:h,stringifiedNode:Y})}e.set(o,p)}}function U(e,t){var s,i;if(e.prop=="animation"){let n=m(t),l=b(e.value),o=!1;for(let a of l){let r=a.name;if(r==null)continue;let f=(s=S.get(n))!=null?s:{rule:t,keyframes:new Set};f.keyframes.has(r)||f.keyframes.add(`@keyframes ${r}`),S.set(n,f),o=!0}return o}else if(e.prop=="animation-name"){let n=m(t),l=(i=S.get(n))!=null?i:{rule:t,keyframes:new Set};return l.keyframes.has(e.value)||l.keyframes.add(`@keyframes ${e.value}`),S.set(n,l),!0}return!1}function m(e){let t="";return e.type=="rule"?(e=e,t=e.selector):e.type=="atrule"&&(e=e,t=`@${e.name} ${e.params}`),t}function R(e,t,s,i,n=1){if(e.nodes==null||e.nodes.length==0)return;let l="",o="";for(let r=0;r<n;r++)l+="	",r<n-1&&(o+="	");let a=t.openBracketNewLine?`
${o}`:" ";if(e.type==="rule"){let r=e,f=r.selectors.join(`,
${o}`);r.selector=f,r.raws.between=a}else if(e.type=="atrule"){let r=e;r.params=r.params.trim(),r.raws.afterName=" ",r.raws.between=a}for(let r of e.nodes)r.type=="decl"&&i.type=="rule"&&U(r,i),r.raws.before=`
`+l,r.raws.after=`
`+l,R(r,t,s,i,n+1);n==1&&(e.raws.before=`
`,t.commentType!=="None"&&(e.raws.before+=`/* From ${s.opts.from} */
`),e.raws.after=`
`)}var w=class{constructor(t,s){this.content=[];this.rule=t,this.intellisensePrefix=s}getMatchedContent(){let t={},s=this.content.map(n=>n.stringifiedNode),i=Object.fromEntries(s.entries());return t[this.intellisensePrefix]=n=>[i,this.rule.stringifiedNode],t}getMatchedValues(){let t={},s=m(this.rule.node).match(/\w+/g).join("-");return t[s]="",{values:t}}};import{readFileSync as _}from"fs";import{resolve as j}from"path";import ne from"postcss";var x="[layer-parser]:";function N(e=1){let t=`
`;for(let s=0;s<e;s++)t+="	";return t+="- ",t}function P(e){console.log(`${x} ${e}`)}function u(e){console.warn(`${x} ${e}`)}function J(e){console.error(`${x} ${e}`)}import{globSync as ie}from"glob";var c=new Map,y=new Map,L=new Map,A=new Map,M=new Map,T=new Map;function z(e,t){let s=m(e);if(y.has(s)||c.has(s)){let i=A.get(s);if(i){let n=i==null?void 0:i.get(t.opts.from);n?i.set(t.opts.from,n+1):i.set(t.opts.from,1)}else A.set(s,new Map([[t.opts.from,1]]));return!1}return!0}function se(e,t,s){var n,l,o;let i=m(e);if(((n=e.parent)==null?void 0:n.type)==="root"){if(z(e,t)){if(s.unlayeredClassBehavior==="Ignore"){let a=(l=M.get(i))!=null?l:new Set;a.add(t.opts.from),M.set(i,a);return}R(e,s,t,e),s.unlayeredClassBehavior==="Utility"?y.set(i,e):s.unlayeredClassBehavior==="Component"&&c.set(i,e)}}else if(((o=e.parent)==null?void 0:o.type)=="atrule"&&z(e,t)){let a=e.parent;a.params==="components"?(R(e,s,t,e),c.set(i,e)):a.params==="utilities"&&(R(e,s,t,e),y.set(i,e))}}function ae(e,t,s){D(e,t,s)}function oe(e){return()=>({Rule(t,{result:s}){se(t,s,e)},AtRule:{keyframes:(t,{result:s})=>{ae(t,s,e)}}})}function le(e){var s,i,n,l,o;let t=a=>a!==!0&&a!==!1;e.directory==null&&(u("There was no directory provided. Defaulting to process.cwd()."),e.directory=process.cwd()),(s=e.commentType)!=null||(e.commentType="File"),e.commentType!=="File"&&e.commentType!="Absolute"&&e.commentType!="None"&&(u("Invalid configuration for commentType. Defaulting to 'File'"),e.commentType="File"),(i=e.openBracketNewLine)!=null||(e.openBracketNewLine=!1),t(e.openBracketNewLine)&&(u("Invalid configuration for openBracketNewLine. Defaulting to false"),e.openBracketNewLine=!1),(n=e.debug)!=null||(e.debug=!1),t(e.debug)&&(u("Invalid configuration for debug. Defaulting to false."),e.debug=!1),(l=e.unlayeredClassBehavior)!=null||(e.unlayeredClassBehavior="Utility"),e.unlayeredClassBehavior!=="Utility"&&e.unlayeredClassBehavior!=="Component"&&e.unlayeredClassBehavior!=="Ignore"&&(u("Invalid configuration for unlayedClassBehavior. Defaulting to Utility"),e.unlayeredClassBehavior="Utility"),(o=e.globPatterns)!=null||(e.globPatterns=["**/*.css"]),(e.animationPrefix==null||e.animationPrefix.trim().length==0)&&(e.animationPrefix="animate")}function G(){c.size==0&&y.size==0&&P("Reset parsed components and utilities."),c.clear(),y.clear(),L.clear(),$()}function V(e){if(e.globPatterns!=null&&e.globPatterns.length>0){for(let a of e.globPatterns)if(a.startsWith("/**"))return J(`User attempted to glob their entire computer using: ${a}. This would result in a serious performance problem, and thus parsing has been skipped.`),{components:[],utilities:[],keyframeUtilities:[]}}le(e),A.clear(),M.clear(),T.clear();let t=j(e.directory),s=[];s=ie(e.globPatterns,{cwd:t}),e.debug&&(P(`Searched directories: ${t}`),P(`Found: ${s.join("	")}`));let i={postcssPlugin:"layer-parser",prepare:oe(e)},n=[],l=ne([i]),o;switch(e.commentType){case"Absolute":o=(a,r)=>{let f=_(r,"utf8");l.process(f,{from:r,to:r}).then(d=>{})};break;default:o=(a,r)=>{let f=_(r,"utf8");l.process(f,{from:a,to:a}).then(d=>{})};break}for(let a of s){if(!a.endsWith(".css")){n.push(a);continue}let r=j(t,a);o(a,r)}if(n.length>0&&u(`Globbing resulted in files that did not end in .css:
	${n.join(N())}`),M.size>0){let a=`The target directory: ${e.directory} had ${M.size} unlayered css rules not parsed:`;if(e.debug)for(let[r,f]of M)a+=`
	${r}`,a+=`
		- `,a+=Array.from(f.values()).join(N(2));u(a)}if(A.size>0){let a="",r=0;for(let[d,p]of A){a+=`
	${d}`;for(let[g,h]of p)a+=`${N(2)}${g} - ${h}`,r+=h}let f=`Found ${r} rules with selectors that were already used. Note, this only discovers root-level (not nested) duplicates that would be added based on the configuration.`;e.debug&&(f+=a),u(f)}if(K(L,c,y,T,e),T.size>0){let a="",r=0;for(let[d,p]of T){a+=`
	${d}`,r+=p.size;for(let g of p)a+=`${N(2)}${g}`}let f=`Could not find ${r} keyframes that were referenced by the searched CSS files.`;e.debug&&(f+=a),u(f)}return{utilities:Array.from(y.values()),components:Array.from(c.values()),keyframeUtilities:Array.from(L.values())}}function Le(e){return({addUtilities:t,addComponents:s,matchUtilities:i})=>{G();let n=V(e);for(let l of n.utilities)t(l);for(let l of n.components)s(l);for(let l of n.keyframeUtilities)i(l.getMatchedContent(),l.getMatchedValues())}}export{w as MatchedAnimationRule,Le as ParseCSS,V as cssParser,G as resetData};
